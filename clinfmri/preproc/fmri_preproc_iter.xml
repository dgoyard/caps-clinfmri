<pipeline>
    <docstring>
        FMRI spatial preunitings (iterative block).

        Steps:
            * Reorientation
            * Slice registration
            * Slice timing
            * Realignement
            * Coregistration
            * Normalization
            * Smoothing
            * BET
    </docstring>
    <units>
        <unit name="fmri_preproc">
            <module>clinfmri.preproc.fmri_preproc.xml</module>
            <set name="output_directory" value="None" />
            <iterinput name="fmri_file"/>
            <iteroutput name="acquisition_time"/>
            <iteroutput name="slice_orders"/>
            <iteroutput name="number_of_slices"/>
            <iteroutput name="repetition_time"/>
            <iteroutput name="realigned_files"/>
            <iteroutput name="smoothed_image_files"/>
            <iteroutput name="normalized_struct_file"/>
            <iteroutput name="normalization_parameters"/>
            <iteroutput name="bet_out_file"/>
            <iteroutput name="forward_deformation_field"/>
            <iteroutput name="normalized_fmri_files"/>
            <iteroutput name="mean_image"/>
            <iteroutput name="realignement_parameters"/>
            <iteroutput name="timecorrected_files"/>
        </unit>
    </units>
    <links>
        <!-- INPUTS -->
        <link source="fmri_file" destination="fmri_preproc.iterfmri_file"/>
        <link source="structural_file" destination="fmri_preproc.structural_file"/>
        <link source="force_repetition_time" destination="fmri_preproc.force_repetition_time"/>
        <link source="force_slice_orders" destination="fmri_preproc.force_slice_orders"/>
        <link source="bet_threshold" destination="fmri_preproc.bet_threshold"/>
        <link source="smooth_fwhm" destination="fmri_preproc.smooth_fwhm"/>
        <link source="template_file" destination="fmri_preproc.template_file"/>
        <link source="coreg_fwhm" destination="fmri_preproc.coreg_fwhm"/>
        <link source="bet_generate_skull" destination="fmri_preproc.bet_generate_skull"/>
        <link source="norm_struct_voxel_sizes" destination="fmri_preproc.norm_struct_voxel_sizes"/>
        <link source="select_slicer" destination="fmri_preproc.select_slicer"/>
        <link source="select_normalization" destination="fmri_preproc.select_normalization"/>
        <link source="norm_func_voxel_sizes" destination="fmri_preproc.norm_func_voxel_sizes"/>
        <link source="realign_register_to_mean" destination="fmri_preproc.realign_register_to_mean"/>
        <link source="bet_generate_binary_mask" destination="fmri_preproc.bet_generate_binary_mask"/>
        <link source="bet_generate_mesh" destination="fmri_preproc.bet_generate_mesh"/>
        <link source="ref_slice" destination="fmri_preproc.ref_slice"/>
        <link source="realign_wrap" destination="fmri_preproc.realign_wrap"/>
        <link source="realign_write_wrap" destination="fmri_preproc.realign_write_wrap"/>
        <!-- OUTPUTS -->
        <link source="fmri_preproc.iteracquisition_time" destination="acquisition_time"/>
        <link source="fmri_preproc.iterslice_orders" destination="slice_orders"/>
        <link source="fmri_preproc.iternumber_of_slices" destination="number_of_slices"/>
        <link source="fmri_preproc.iterrepetition_time" destination="repetition_time"/>
        <link source="fmri_preproc.iterrealigned_files" destination="realigned_files"/>
        <link source="fmri_preproc.itersmoothed_image_files" destination="smoothed_image_files"/>
        <link source="fmri_preproc.iternormalized_struct_file" destination="normalized_struct_file"/>
        <link source="fmri_preproc.iternormalization_parameters" destination="normalization_parameters"/>
        <link source="fmri_preproc.iterbet_out_file" destination="bet_out_file"/>
        <link source="fmri_preproc.iterforward_deformation_field" destination="forward_deformation_field"/>
        <link source="fmri_preproc.iternormalized_fmri_files" destination="normalized_fmri_files"/>
        <link source="fmri_preproc.itermean_image" destination="mean_image"/>
        <link source="fmri_preproc.iterrealignement_parameters" destination="realignement_parameters"/>
        <link source="fmri_preproc.itertimecorrected_files" destination="timecorrected_files"/>
    </links>
    <positions>
        <position unit="inputs" x="-337" y="50"/>
        <position unit="outputs" x="471" y="500"/>
        <position unit="fmri_preproc" x="50" y="50"/>
    </positions>
    <zoom level="1"/>
</pipeline>
